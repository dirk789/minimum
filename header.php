<?php 

function custom_mini_cart() { 
    echo '<a href="#" class="dropdown-back" data-toggle="dropdown"> ';
    echo '<i class="fa fa-shopping-cart" aria-hidden="true"></i>';
    echo '<div class="basket-item-count" style="display: inline;">';
        echo '<span class="cart-items-count count">';
            echo WC()->cart->get_cart_contents_count();
        echo '</span>';
    echo '</div>';
    echo '</a>';
    echo '<ul class="dropdown-menu dropdown-menu-mini-cart">';
        echo '<li> <div class="widget_shopping_cart_content">';
                  woocommerce_mini_cart();
            echo '</div></li></ul>';

      }
       add_shortcode( '[custom-casanha-mini-cart]', 'custom_mini_cart' );


// MAIN MENU

function casanhaheader_function() {
   
    echo "
    <header id=\"header__mega\">
    <div class=\"logo\"> <svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 114 35\"> <defs /> <path d=\"M0 17.5V35h8.75V17.5h8.204v1.504c0 1.367-.055 1.531-.766 1.887-.793.41-1.422 1.449-1.422 2.379 0 .683.985 1.066 2.734 1.066 1.641 0 2.735-.465 2.735-1.148 0-.848-.738-1.997-1.477-2.352-.628-.273-.71-.465-.71-1.832V17.5h8.203V35H35V0H0v17.5zM44.107 4.566c-.274.082-.356 1.204-.356 4.184 0 3.445.055 4.074.438 4.21.82.329 7.629.192 7.984-.163.192-.192.329-.793.329-1.367 0-1.012-.028-1.04-.93-1.04s-.957.055-1.04 1.012l-.081 1.04h-4.649V5.058h4.649l.082 1.039c.082.984.137 1.039.957.957.765-.082.875-.192.957-.985.164-1.586-.137-1.695-4.293-1.668-2.051 0-3.883.082-4.047.164zM56.877 8.504a303.301 303.301 0 00-1.86 4.375c-.054.137.328.246.82.246.821 0 .985-.11 1.286-.957l.328-.957h4.32l.329.957c.3.82.465.957 1.258.957.492 0 .902-.082.902-.164s-.82-2.05-1.832-4.375l-1.805-4.211H58.654l-1.777 4.129zm3.746-.3l.848 2.187h-3.72l.849-2.188c.492-1.203.93-2.187 1.011-2.187.082 0 .52.984 1.012 2.187zM67.35 4.566c-.219.082-.356.63-.356 1.34V7.11l3.309 1.641 3.281 1.668-.082 1.012-.082 1.011-2.242.082-2.27.082v-1.12c0-1.067-.027-1.094-.957-1.094-.957 0-.957 0-.957 1.203 0 .847.137 1.258.438 1.367.82.328 7.355.191 7.711-.164.492-.492.41-2.242-.137-2.735-.273-.246-1.75-1.011-3.308-1.722L68.88 7.027l.082-.984.082-.984h4.375l.082 1.039c.082.984.137 1.039.957.957.766-.082.875-.192.957-.985.165-1.586-.136-1.695-4.156-1.668-1.969 0-3.746.082-3.91.164zM81.378 5.25c-.22.492-.657 1.504-.985 2.27-.328.738-1.012 2.324-1.531 3.472l-.902 2.133h.93c.792 0 .956-.11 1.257-.957l.355-.957H84.796l.41.957c.328.82.52.957 1.312.957h.957l-1.886-4.32-1.86-4.293-.984-.082c-.903-.082-1.04 0-1.367.82zm2.433 3.363l.684 1.778h-1.778c-.984 0-1.777-.055-1.777-.137 0-.055.246-.766.574-1.559.328-.793.684-1.75.848-2.133.219-.601.273-.628.52-.218.136.273.574 1.285.93 2.27zM97.347 4.512c0 .082 1.558 2.05 3.445 4.375l3.473 4.238h1.313c.738 0 1.339-.055 1.339-.137 0-.082-.957-2.05-2.105-4.375l-2.133-4.238h-2.652c-1.477 0-2.68.055-2.68.137zM43.751 25.977V35H47.58l.054-6.563.082-6.535 5.88 6.535 5.879 6.508 1.449.028 1.422.027V16.953H58.517l-.054 6.399-.082 6.37-5.825-6.37-5.824-6.399H43.75v9.024zM69.729 25.977V35h3.801l.082-4.32.082-4.293 5.414-.082 5.387-.055V35h4.102V16.953h-4.102v7.93H73.557v-7.93h-3.828v9.024zM101.476 18.102c-.274.656-2.051 4.648-3.965 8.914-1.887 4.238-3.446 7.765-3.446 7.847 0 .082.848.137 1.887.137h1.887l.793-1.996.793-1.969H108.421l.793 1.969.821 1.996H114l-1.313-2.953c-.711-1.613-2.516-5.66-3.992-9.024l-2.68-6.07H101.968l-.492 1.149zm6.262 11.21c0 .137-1.723.22-3.829.22-2.105 0-3.828-.055-3.828-.137 0-.165 3.555-8.915 3.746-9.27.137-.191 3.883 8.668 3.911 9.188z\" fill=\"#000\" /></svg> </div> 

    <nav id=\"nav--desktop\">
            <ul class=\"casanha-mega-menu\">";
                
                    $locations = get_nav_menu_locations();
                    if ( isset( $locations[ 'mega_menu' ] ) ) {
                        $menu = get_term( $locations[ 'mega_menu' ], 'nav_menu' );
                        if ( $items = wp_get_nav_menu_items( $menu->name ) ) {
                            foreach ( $items as $item ) {
                                echo "<li>";
                                    echo "<a href=\"{$item->url}\">{$item->title}</a>";
                                    if ( is_active_sidebar( 'mega-menu-widget-area-' . $item->ID ) ) {
                                        echo "<div id=\"casanha-mega-menu-{$item->ID}\" class=\"mega-menu mega-menu__dropdown\">";
                                            echo "<div class=\"mega-menu-inner\">";
                                            dynamic_sidebar( 'mega-menu-widget-area-' . $item->ID );
                                            echo "</div>";
                                        echo "</div>";
                                    }
                                echo "</li>";
                            }
                        }
                    }

                echo "</ul>  
        </nav>"; 

        woocommerce_mini_cart();
        
        echo "
    </header>
        ";
}

add_shortcode('casanhaheader', 'casanhaheader_function');
